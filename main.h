/*---------------------------------------------------------------------

  Bienchen - UCI chess engine
  Â© 2022 Manuel Schenske

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program. If not, see <https://www.gnu.org/licenses/>.

---------------------------------------------------------------------*/

#ifndef MAIN_H
#define MAIN_H

//#define DEBUG
#ifndef DEBUG
#define NDEBUG
#endif

#include "bits.h"
#include <cassert>

// clang-format off
enum Squares {

  A1, B1, C1, D1, E1, F1, G1, H1,
  A2, B2, C2, D2, E2, F2, G2, H2,
  A3, B3, C3, D3, E3, F3, G3, H3,
  A4, B4, C4, D4, E4, F4, G4, H4,
  A5, B5, C5, D5, E5, F5, G5, H5,
  A6, B6, C6, D6, E6, F6, G6, H6,
  A7, B7, C7, D7, E7, F7, G7, H7,
  A8, B8, C8, D8, E8, F8, G8, H8, N_SQ
};

enum { B_, W_, N_CLR };
enum { MG, EG, N_STG };
enum { EMPTY, PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING, N_PIECES };
enum { EP = 1, BP, WP, BN, WN, BB, WB, BR, WR, BQ, WQ, BK, WK, N_PT };
enum { W_OO = 1, W_OOO = 2, W_OO_OOO = W_OO | W_OOO,
       B_OO = 4, B_OOO = 8, B_OO_OOO = B_OO | B_OOO};

static constexpr int PATT{0};
static constexpr int MATT{10000};
static constexpr int INF{MATT + 1};
static constexpr int SCORE_NONE{-MATT - 2};
static constexpr int EVAL_MIN{-MATT + 128};
static constexpr int EVAL_MAX{MATT - 128};
static constexpr int MATT_IN_MAX{MATT - 128};
static constexpr int VAL[14]    = {0, 0, 1, 1, 3, 3, 3, 3, 5, 5, 8, 8, 1, 1};
static constexpr int VALUE[7]   = {0, 100, 330, 330, 500, 900, 0};
static constexpr int MAX_DEPTH  = 128;

static constexpr int CR[N_SQ] = {

  13, 15, 15, 15, 12, 15, 15, 14,
  15, 15, 15, 15, 15, 15, 15, 15,
  15, 15, 15, 15, 15, 15, 15, 15,
  15, 15, 15, 15, 15, 15, 15, 15,
  15, 15, 15, 15, 15, 15, 15, 15,
  15, 15, 15, 15, 15, 15, 15, 15,
  15, 15, 15, 15, 15, 15, 15, 15,
  7,  15, 15, 15, 3,  15, 15, 11};

static constexpr u64 K_MASK[64] = {
  0x0000000000000302, 0x0000000000000705, 0x0000000000000E0A, 0x0000000000001C14,
  0x0000000000003828, 0x0000000000007050, 0x000000000000E0A0, 0x000000000000C040,
  0x0000000000030203, 0x0000000000070507, 0x00000000000E0A0E, 0x00000000001C141C,
  0x0000000000382838, 0x0000000000705070, 0x0000000000E0A0E0, 0x0000000000C040C0,
  0x0000000003020300, 0x0000000007050700, 0x000000000E0A0E00, 0x000000001C141C00,
  0x0000000038283800, 0x0000000070507000, 0x00000000E0A0E000, 0x00000000C040C000,
  0x0000000302030000, 0x0000000705070000, 0x0000000E0A0E0000, 0x0000001C141C0000,
  0x0000003828380000, 0x0000007050700000, 0x000000E0A0E00000, 0x000000C040C00000,
  0x0000030203000000, 0x0000070507000000, 0x00000E0A0E000000, 0x00001C141C000000,
  0x0000382838000000, 0x0000705070000000, 0x0000E0A0E0000000, 0x0000C040C0000000,
  0x0003020300000000, 0x0007050700000000, 0x000E0A0E00000000, 0x001C141C00000000,
  0x0038283800000000, 0x0070507000000000, 0x00E0A0E000000000, 0x00C040C000000000,
  0x0302030000000000, 0x0705070000000000, 0x0E0A0E0000000000, 0x1C141C0000000000,
  0x3828380000000000, 0x7050700000000000, 0xE0A0E00000000000, 0xC040C00000000000,
  0x0203000000000000, 0x0507000000000000, 0x0A0E000000000000, 0x141C000000000000,
  0x2838000000000000, 0x5070000000000000, 0xA0E0000000000000, 0x40C0000000000000};
static constexpr u64 R_MASK[64] = {
  0x01010101010101FE, 0x02020202020202FD, 0x04040404040404FB, 0x08080808080808F7,
  0x10101010101010EF, 0x20202020202020DF, 0x40404040404040BF, 0x808080808080807F,
  0x010101010101FE01, 0x020202020202FD02, 0x040404040404FB04, 0x080808080808F708,
  0x101010101010EF10, 0x202020202020DF20, 0x404040404040BF40, 0x8080808080807F80,
  0x0101010101FE0101, 0x0202020202FD0202, 0x0404040404FB0404, 0x0808080808F70808,
  0x1010101010EF1010, 0x2020202020DF2020, 0x4040404040BF4040, 0x80808080807F8080,
  0x01010101FE010101, 0x02020202FD020202, 0x04040404FB040404, 0x08080808F7080808,
  0x10101010EF101010, 0x20202020DF202020, 0x40404040BF404040, 0x808080807F808080,
  0x010101FE01010101, 0x020202FD02020202, 0x040404FB04040404, 0x080808F708080808,
  0x101010EF10101010, 0x202020DF20202020, 0x404040BF40404040, 0x8080807F80808080,
  0x0101FE0101010101, 0x0202FD0202020202, 0x0404FB0404040404, 0x0808F70808080808,
  0x1010EF1010101010, 0x2020DF2020202020, 0x4040BF4040404040, 0x80807F8080808080,
  0x01FE010101010101, 0x02FD020202020202, 0x04FB040404040404, 0x08F7080808080808,
  0x10EF101010101010, 0x20DF202020202020, 0x40BF404040404040, 0x807F808080808080,
  0xFE01010101010101, 0xFD02020202020202, 0xFB04040404040404, 0xF708080808080808,
  0xEF10101010101010, 0xDF20202020202020, 0xBF40404040404040, 0x7F80808080808080};
static constexpr u64 B_MASK[64] = {
  0x8040201008040200, 0x0080402010080500, 0x0000804020110A00, 0x0000008041221400,
  0x0000000182442800, 0x0000010204885000, 0x000102040810A000, 0x0102040810204000,
  0x4020100804020002, 0x8040201008050005, 0x00804020110A000A, 0x0000804122140014,
  0x0000018244280028, 0x0001020488500050, 0x0102040810A000A0, 0x0204081020400040,
  0x2010080402000204, 0x4020100805000508, 0x804020110A000A11, 0x0080412214001422,
  0x0001824428002844, 0x0102048850005088, 0x02040810A000A010, 0x0408102040004020,
  0x1008040200020408, 0x2010080500050810, 0x4020110A000A1120, 0x8041221400142241,
  0x0182442800284482, 0x0204885000508804, 0x040810A000A01008, 0x0810204000402010,
  0x0804020002040810, 0x1008050005081020, 0x20110A000A112040, 0x4122140014224180,
  0x8244280028448201, 0x0488500050880402, 0x0810A000A0100804, 0x1020400040201008,
  0x0402000204081020, 0x0805000508102040, 0x110A000A11204080, 0x2214001422418000,
  0x4428002844820100, 0x8850005088040201, 0x10A000A010080402, 0x2040004020100804,
  0x0200020408102040, 0x0500050810204080, 0x0A000A1120408000, 0x1400142241800000,
  0x2800284482010000, 0x5000508804020100, 0xA000A01008040201, 0x4000402010080402,
  0x0002040810204080, 0x0005081020408000, 0x000A112040800000, 0x0014224180000000,
  0x0028448201000000, 0x0050880402010000, 0x00A0100804020100, 0x0040201008040201};
static constexpr u64 N_MASK[64] = {
  0x0000000000020400, 0x0000000000050800, 0x00000000000A1100, 0x0000000000142200,
  0x0000000000284400, 0x0000000000508800, 0x0000000000A01000, 0x0000000000402000,
  0x0000000002040004, 0x0000000005080008, 0x000000000A110011, 0x0000000014220022,
  0x0000000028440044, 0x0000000050880088, 0x00000000A0100010, 0x0000000040200020,
  0x0000000204000402, 0x0000000508000805, 0x0000000A1100110A, 0x0000001422002214,
  0x0000002844004428, 0x0000005088008850, 0x000000A0100010A0, 0x0000004020002040,
  0x0000020400040200, 0x0000050800080500, 0x00000A1100110A00, 0x0000142200221400,
  0x0000284400442800, 0x0000508800885000, 0x0000A0100010A000, 0x0000402000204000,
  0x0002040004020000, 0x0005080008050000, 0x000A1100110A0000, 0x0014220022140000,
  0x0028440044280000, 0x0050880088500000, 0x00A0100010A00000, 0x0040200020400000,
  0x0204000402000000, 0x0508000805000000, 0x0A1100110A000000, 0x1422002214000000,
  0x2844004428000000, 0x5088008850000000, 0xA0100010A0000000, 0x4020002040000000,
  0x0400040200000000, 0x0800080500000000, 0x1100110A00000000, 0x2200221400000000,
  0x4400442800000000, 0x8800885000000000, 0x100010A000000000, 0x2000204000000000,
  0x0004020000000000, 0x0008050000000000, 0x00110A0000000000, 0x0022140000000000,
  0x0044280000000000, 0x0088500000000000, 0x0010A00000000000, 0x0020400000000000};
static constexpr u64 WP_MASK[64] = {
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000001010000, 0x0000000002020000, 0x0000000004040000, 0x0000000008080000,
  0x0000000010100000, 0x0000000020200000, 0x0000000040400000, 0x0000000080800000,
  0x0000000001000000, 0x0000000002000000, 0x0000000004000000, 0x0000000008000000,
  0x0000000010000000, 0x0000000020000000, 0x0000000040000000, 0x0000000080000000,
  0x0000000100000000, 0x0000000200000000, 0x0000000400000000, 0x0000000800000000,
  0x0000001000000000, 0x0000002000000000, 0x0000004000000000, 0x0000008000000000,
  0x0000010000000000, 0x0000020000000000, 0x0000040000000000, 0x0000080000000000,
  0x0000100000000000, 0x0000200000000000, 0x0000400000000000, 0x0000800000000000,
  0x0001000000000000, 0x0002000000000000, 0x0004000000000000, 0x0008000000000000,
  0x0010000000000000, 0x0020000000000000, 0x0040000000000000, 0x0080000000000000,
  0x0100000000000000, 0x0200000000000000, 0x0400000000000000, 0x0800000000000000,
  0x1000000000000000, 0x2000000000000000, 0x4000000000000000, 0x8000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000};
static constexpr u64 WP_ATCK[64] = {
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000020000, 0x0000000000050000, 0x00000000000A0000, 0x0000000000140000,
  0x0000000000280000, 0x0000000000500000, 0x0000000000A00000, 0x0000000000400000,
  0x0000000002000000, 0x0000000005000000, 0x000000000A000000, 0x0000000014000000,
  0x0000000028000000, 0x0000000050000000, 0x00000000A0000000, 0x0000000040000000,
  0x0000000200000000, 0x0000000500000000, 0x0000000A00000000, 0x0000001400000000,
  0x0000002800000000, 0x0000005000000000, 0x000000A000000000, 0x0000004000000000,
  0x0000020000000000, 0x0000050000000000, 0x00000A0000000000, 0x0000140000000000,
  0x0000280000000000, 0x0000500000000000, 0x0000A00000000000, 0x0000400000000000,
  0x0002000000000000, 0x0005000000000000, 0x000A000000000000, 0x0014000000000000,
  0x0028000000000000, 0x0050000000000000, 0x00A0000000000000, 0x0040000000000000,
  0x0200000000000000, 0x0500000000000000, 0x0A00000000000000, 0x1400000000000000,
  0x2800000000000000, 0x5000000000000000, 0xA000000000000000, 0x4000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000};
static constexpr u64 BP_MASK[64] = {
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000001, 0x0000000000000002, 0x0000000000000004, 0x0000000000000008,
  0x0000000000000010, 0x0000000000000020, 0x0000000000000040, 0x0000000000000080,
  0x0000000000000100, 0x0000000000000200, 0x0000000000000400, 0x0000000000000800,
  0x0000000000001000, 0x0000000000002000, 0x0000000000004000, 0x0000000000008000,
  0x0000000000010000, 0x0000000000020000, 0x0000000000040000, 0x0000000000080000,
  0x0000000000100000, 0x0000000000200000, 0x0000000000400000, 0x0000000000800000,
  0x0000000001000000, 0x0000000002000000, 0x0000000004000000, 0x0000000008000000,
  0x0000000010000000, 0x0000000020000000, 0x0000000040000000, 0x0000000080000000,
  0x0000000100000000, 0x0000000200000000, 0x0000000400000000, 0x0000000800000000,
  0x0000001000000000, 0x0000002000000000, 0x0000004000000000, 0x0000008000000000,
  0x0000010100000000, 0x0000020200000000, 0x0000040400000000, 0x0000080800000000,
  0x0000101000000000, 0x0000202000000000, 0x0000404000000000, 0x0000808000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000};
static constexpr u64 BP_ATCK[64] = {
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000002, 0x0000000000000005, 0x000000000000000A, 0x0000000000000014,
  0x0000000000000028, 0x0000000000000050, 0x00000000000000A0, 0x0000000000000040,
  0x0000000000000200, 0x0000000000000500, 0x0000000000000A00, 0x0000000000001400,
  0x0000000000002800, 0x0000000000005000, 0x000000000000A000, 0x0000000000004000,
  0x0000000000020000, 0x0000000000050000, 0x00000000000A0000, 0x0000000000140000,
  0x0000000000280000, 0x0000000000500000, 0x0000000000A00000, 0x0000000000400000,
  0x0000000002000000, 0x0000000005000000, 0x000000000A000000, 0x0000000014000000,
  0x0000000028000000, 0x0000000050000000, 0x00000000A0000000, 0x0000000040000000,
  0x0000000200000000, 0x0000000500000000, 0x0000000A00000000, 0x0000001400000000,
  0x0000002800000000, 0x0000005000000000, 0x000000A000000000, 0x0000004000000000,
  0x0000020000000000, 0x0000050000000000, 0x00000A0000000000, 0x0000140000000000,
  0x0000280000000000, 0x0000500000000000, 0x0000A00000000000, 0x0000400000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
  0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000};
static constexpr u64 R_MAGIC[64] = {
  0x0080002080400014, 0x0040004010002008, 0xa080088020001000, 0x0080100080080004,
  0x1080040008000280, 0x0880040080220001, 0x0080020000800100, 0xa200104481002406,
  0x0019800082204000, 0x0000804000200080, 0x2000808010002000, 0x0121000810002100,
  0x0040808008000400, 0x0000800200800400, 0x2082008804010200, 0x0020800080004100,
  0x0420818000204000, 0x0010044000442000, 0x1040828010002008, 0x02001200200a0040,
  0x0004008004080080, 0x8010818012000400, 0x0002010100020004, 0x1020020000408401,
  0x4040004080008038, 0x4000400080802000, 0x5000104100200100, 0x400a0042000c1020,
  0x0008020040040041, 0x0000040080800200, 0x0008010080800200, 0x0000012200008044,
  0x00004002a2800081, 0x0000201002400040, 0x0010002800200400, 0x2000800800801000,
  0x0000100801000500, 0x1001000401000208, 0x8000800200800100, 0x5800800040800100,
  0x0800400080208000, 0x4090104020004000, 0x0020001000808022, 0x0000080010008080,
  0x1000040008008080, 0x4004040002008080, 0x0101000200010004, 0x0409002040810002,
  0x4580204000800080, 0x0840200040008180, 0x0000402000110100, 0x0000201001000900,
  0x0010800400080080, 0x0000800400020080, 0x2040100881020400, 0x0200004400810200,
  0x0000208000410011, 0x0000802100104001, 0x4083004008200411, 0x0c80200810000501,
  0x0413001002080005, 0x080a001008040102, 0x0440020100881004, 0x0000002081040042};
static constexpr u64 B_MAGIC[64] = {
  0x0404108410448600, 0x0042280104008040, 0x0010042080280001, 0x80082048400c0400,
  0x0104042018002800, 0x0004240440001000, 0x01b84104a0200000, 0x0000804050042000,
  0x0040080808084049, 0x0800040408204100, 0x2000080204082000, 0x0008082080200010,
  0x8057040420001002, 0x0000011002110004, 0x0000008808480420, 0x0040020041480800,
  0x0004024010820200, 0x0220100401022200, 0x0001001024008010, 0x0008002082004000,
  0x000a000422010000, 0x0300201202012001, 0x0801022084012000, 0x00220000221104a0,
  0x0003080060a00400, 0x0014204004410400, 0x0220440008002400, 0x0000404004010200,
  0x0001010000104000, 0x0001010002100081, 0x1001040001040112, 0x0000820000806400,
  0x0202200402200804, 0x0002080400200120, 0x0006005002010100, 0x4100400a00002200,
  0x0002020200100808, 0x0010100080004048, 0x0802081200010080, 0x4601010a00010040,
  0x0001101004001008, 0x0342280208000200, 0x00020c00440a0800, 0x0000004200800800,
  0x0000200410400402, 0x2020200400200042, 0x0005a41482000400, 0x0002081100200110,
  0x0200880802100005, 0x00020080c4100000, 0x0040070048120100, 0x8000000104980050,
  0x0000101182020000, 0x8202200202420000, 0x0020040408404000, 0x0010020084008880,
  0xa400110410020800, 0x0000011082012000, 0x0010000100411000, 0x0000002400420229,
  0x0000000004104400, 0x0000000802480200, 0x00000a5001420400, 0x2002040108110100};
static constexpr u64 RANK_MASK[8] = {
  0x00000000000000FF,
  0x000000000000FF00,
  0x0000000000FF0000,
  0x00000000FF000000,
  0x000000FF00000000,
  0x0000FF0000000000,
  0x00FF000000000000,
  0xFF00000000000000};
static constexpr u64 FILE_MASK[8] = {
  0x0101010101010101,
  0x0202020202020202,
  0x0404040404040404,
  0x0808080808080808,
  0x1010101010101010,
  0x2020202020202020,
  0x4040404040404040,
  0x8080808080808080};
// clang-format on

static constexpr u64 UNIVERSE = 0xFFFFFFFFFFFFFFFF;
static constexpr u64 LITE_SQ  = 0x55AA55AA55AA55AA;
static constexpr u64 CENTER16 = 0x00003C3C3C3C0000;
static constexpr u64 CENTER4  = 0x0000001818000000;
static constexpr u64 W_HALF   = 0x00000000FFFFFFFF;
static constexpr u64 B_HALF   = 0xFFFFFFFF00000000;
static constexpr u64 PROM     = 0xFF000000000000FF;
static constexpr u64 PUSH     = 0x00FF00000000FF00;

// const u64 MASK_FLAG = 0xFFFFFF0000FF00FF;
// const u64 CENTER36  = 0x007E7E7E7E7E7E00;
// const u64 DARK_SQ   = 0xAA55AA55AA55AA55;

#endif